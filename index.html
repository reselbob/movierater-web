<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Movie Rater</title>
</head>
<script
        src="http://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
<body>

<style>
    #ratingList{
        width: 800px;
    }
</style>

<h1>The El Nido Tech Academy Movie Rater</h1>

<table id="entryForm">
    <tr>
        <td>
            Movie
        </td>
        <td>
            <select id="movie" />
        </td>
    </tr>
    <tr>
        <td>
            Rating
        </td>
        <td>
            <select id="rating" />
        </td>
    </tr>
    <tr>
        <td>
            Rater Email
        </td>
        <td>
            <input id="raterEmail" />
        </td>
    </tr>
    <tr>
        <td>
            Submit
        </td>
        <td>
            <input type="submit" id="submit" onclick="submitRating()"/>
        </td>
    </tr>

</table>
<hr>
<table id="ratingList">
    <tr><td>Movie</td><td>Rating</td><td>Rater</td></tr>

</table>
<script>

    var dataUrl = '';

    function populateMoviesAsync(dropDownId){
        // go out the the internet the get the data
        $.ajax({
            url:dataUrl,
            accepts: 'application/json',
            type: 'GET',
            success: function(data) {
                //called when successful

                //get the dropdown and load the data
                console.log(data);
                loadDataToDropDown(dropDownId, data);
            },
            error: function(e) {
                //called when there is an error
                console.log(e.message);
            }
        });
    }

    function loadDataToDropDown(dropDownId, data){
        var movieElement = document.getElementById(dropDownId);
        var op = document.createElement('option');
        op.innerHTML = "Select a Movie";
        op.value = 0;
        movieElement.append(op);

        data.forEach(function(movie) {
            console.log(JSON.stringify(movie));
            var option = document.createElement('option');
            option.innerHTML = movie.text;
            option.value = movie.id;
            movieElement.append(option)
        });
    }

    function populateMovies(){
        //make a list of movies
        var movies = [];
        movies.push("Gone With the Wind");
        movies.push("Flash");
        movies.push("JusticeLeagueOfAmerica");

        //find the movies dropdown
        var movieElement = document.getElementById("movie");
        //Create a null choice

        var op = document.createElement('option');
        op.innerHTML = "Select a Movie";
        op.value = 0;
        movieElement.append(op);

        for(var i = 0; i < movies.length; i++) {
            var option = document.createElement('option');
            option.innerHTML = movies[i];
            option.value = movies[i];
            movieElement.append(option)
        }

    }
    function populateRatings(){
        //create rating array
        var ratings = [];
        ratings.push({"rating": -1, "text": "Select a rating"});
        ratings.push({"rating": 0, "text": "Awful"});
        ratings.push({"rating": 1, "text": "Not too Bad"});
        ratings.push({"rating": 2, "text": "OK"});
        ratings.push({"rating": 3, "text": "Good"});
        ratings.push({"rating": 4, "text": "Great!"});

        //find the rating dropdown
        var ratingElement = document.getElementById("rating");

        for(var i = 0; i < ratings.length; i++) {
            var option = document.createElement('option');
            option.innerHTML = ratings[i].text;
            option.value = ratings[i].rating;
            ratingElement.append(option)
        }

    }

    function validateEmail(){

    }

    function addEntryToUiList(entry){
        var table = document.getElementById("ratingList");
        // Create an empty <tr> element and add it to the 1st position of the table:
        var row = table.insertRow(table.rows.length);

    // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);

    // Add some text to the new cells:
        cell1.innerHTML = entry.movie;
        cell2.innerHTML = entry.rating;
        cell3.innerHTML = entry.rater;
    }

    function submitRating(){

        var rating = {};
        var e = document.getElementById("rating");
        rating.text = e.options[e.selectedIndex].text;
        rating.value = e.options[e.selectedIndex].value;



        var movie = {}
        var e = document.getElementById("movie");
        movie.text = e.options[e.selectedIndex].text;
        movie.value = e.options[e.selectedIndex].value;


        var email = document.getElementById("raterEmail").value;

        var str = "I am going to send the following rating information:\n";
        str += "Movie : " + movie.text + "\n";
        str += "Rating text : " + rating.text + "\n";
        str += "Rating value : " + rating.value + "\n";
        str += "From ratier : " + email + "\n";

        var entry = {};
        entry.movie = movie.text;
        entry.rating = rating.text;
        entry.rater = email;

        addEntryToUiList(entry)

        alert(str);

        return alert("Just kidding. This feature is not yet implemented");

    }

    populateMoviesAsync("movie");
    populateRatings();

</script>

</body>
</html>